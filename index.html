<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Bathroom Estimator (Luxury Edition)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'IBM Plex Sans Thai', sans-serif; 
            background-color: #f9fafb; /* Clean White/Gray */
            color: #1e293b;
        }
        
        .font-serif { font-family: 'Playfair Display', serif; }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        /* Custom Gold Colors */
        .text-gold { color: #C5A059; }
        .bg-gold { background-color: #C5A059; }
        .border-gold { border-color: #C5A059; }
        .ring-gold { --tw-ring-color: #C5A059; }
        
        /* Glass & Shadows */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        .shadow-luxury {
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.05);
        }

        /* Blueprint Pattern (Subtle) */
        .bg-blueprint {
            background-color: #ffffff;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }

        @media print {
            body { background-color: white; padding: 0; }
            #sidebar-col, #nav-wrapper, header .flex-col, .no-print, #inner-tabs { display: none !important; }
            #main-content-col { width: 100%; grid-column: span 12; }
            #content-area { border: none; box-shadow: none; min-height: auto; background: white !important; }
            .print-full-width { width: 100% !important; }
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 bg-gray-50">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8 flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
            <div class="text-left">
                <div class="text-[10px] font-bold text-gold uppercase tracking-[0.2em] mb-2 flex items-center gap-3">
                    <span class="w-6 h-[1px] bg-gold inline-block"></span> 
                    ESTIMATOR & BOQ SYSTEM
                </div>
                <h1 class="text-4xl md:text-5xl font-serif text-slate-900 tracking-tight">
                    Bathroom <span class="italic text-slate-400">Selector</span>
                </h1>
            </div>
            
            <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto items-end no-print">
                <div class="relative w-full md:w-48 group">
                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Sanitary Grade</label>
                    <div class="relative">
                        <select id="grade-selector" onchange="changeGrade()" class="block w-full appearance-none rounded-none border-b-2 border-slate-200 bg-transparent py-2 pl-0 pr-8 text-slate-800 font-serif font-bold focus:border-gold focus:ring-0 sm:text-base cursor-pointer transition-all">
                            <option value="standard">Standard Class</option>
                            <option value="premium">Premium Class</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center text-gold">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" /></svg>
                        </div>
                    </div>
                </div>
                <div class="relative w-full md:w-48 group">
                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Room Series</label>
                    <div class="relative">
                        <select id="series-selector" onchange="changeSeries()" class="block w-full appearance-none rounded-none border-b-2 border-slate-200 bg-transparent py-2 pl-0 pr-8 text-slate-800 font-serif font-bold focus:border-gold focus:ring-0 sm:text-base cursor-pointer transition-all"></select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center text-gold">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" /></svg>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="switchView('detail')" id="btn-detail" class="px-5 py-2.5 rounded-full text-xs font-bold uppercase tracking-wide transition-all bg-slate-900 text-gold shadow-lg shadow-slate-200">Detail</button>
                    <button onclick="switchView('dashboard')" id="btn-dashboard" class="px-5 py-2.5 rounded-full text-xs font-bold uppercase tracking-wide transition-all bg-white text-slate-400 hover:text-slate-600 border border-slate-200">Analytics</button>
                </div>
            </div>
        </header>

        <!-- Navigation (Variants) -->
        <div id="nav-wrapper" class="sticky top-0 z-30 bg-gray-50/90 backdrop-blur-md py-4 mb-8 -mx-4 px-4 md:static md:bg-transparent md:p-0 md:m-0 transition-all duration-300 no-print">
            <div id="nav-container" class="flex md:grid md:grid-cols-5 gap-4 overflow-x-auto hide-scrollbar pb-2 md:pb-0 snap-x"></div>
        </div>

        <!-- Main Content -->
        <div class="grid lg:grid-cols-12 gap-8 items-start">
            <div id="main-content-col" class="lg:col-span-8 xl:col-span-9 transition-all">
                <!-- Inner Tabs -->
                <div id="inner-tabs" class="flex gap-1 mb-6 overflow-x-auto pb-1 hide-scrollbar no-print border-b border-slate-200">
                    <button onclick="setTab('specs')" id="tab-specs" class="px-6 py-3 text-sm font-bold tracking-wide transition-all flex items-center gap-2 whitespace-nowrap border-b-2 border-gold text-slate-900">
                        SPECS & BOQ
                    </button>
                    <button onclick="setTab('plan')" id="tab-plan" class="px-6 py-3 text-sm font-medium tracking-wide transition-all flex items-center gap-2 whitespace-nowrap border-b-2 border-transparent text-slate-400 hover:text-slate-600">
                        FLOOR PLAN
                    </button>
                    <button onclick="setTab('3d')" id="tab-3d" class="px-6 py-3 text-sm font-medium tracking-wide transition-all flex items-center gap-2 whitespace-nowrap border-b-2 border-transparent text-slate-400 hover:text-slate-600">
                        3D VIEW
                    </button>
                </div>

                <div id="content-area" class="min-h-[600px] rounded-sm transition-all duration-500 relative overflow-hidden bg-white shadow-luxury border border-slate-100"></div>
            </div>

            <!-- Sidebar -->
            <div id="sidebar-col" class="lg:col-span-4 xl:col-span-3 space-y-6 sticky top-24 transition-all no-print">
                <!-- Info Card (Black & Gold) -->
                <div class="bg-slate-900 text-white rounded-none p-8 relative overflow-hidden group shadow-2xl">
                    <div class="absolute top-0 right-0 w-20 h-20 border-t-[1px] border-r-[1px] border-gold opacity-20"></div>
                    <div class="absolute bottom-0 left-0 w-20 h-20 border-b-[1px] border-l-[1px] border-gold opacity-20"></div>
                    
                    <h3 class="font-bold text-gold mb-4 text-[10px] uppercase tracking-[0.2em]">Current Model</h3>
                    <div class="text-5xl font-serif text-white mb-2 flex items-baseline gap-2 tracking-tight">
                        <span id="sidebar-model-code">...</span>
                    </div>
                    <div class="flex items-center gap-3 mb-8">
                        <span class="h-[1px] w-8 bg-slate-700"></span>
                        <span class="text-sm font-light text-slate-400" id="sidebar-grade">STD</span>
                    </div>
                    
                    <div class="space-y-4 pt-6 border-t border-slate-800">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-slate-500 uppercase tracking-wider text-[10px]">Dimensions</span>
                            <span class="font-medium text-slate-300" id="sidebar-model-size">...</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-slate-500 uppercase tracking-wider text-[10px]">Function</span>
                            <span class="font-medium text-slate-300" id="sidebar-function">...</span>
                        </div>
                        <!-- FIX: Added missing layout field to prevent JS error -->
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-slate-500 uppercase tracking-wider text-[10px]">Layout</span>
                            <span class="font-medium text-slate-300" id="sidebar-desc">...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Available Variants -->
                <div class="bg-white p-6 border border-slate-100 shadow-sm">
                    <h3 class="font-bold text-slate-800 mb-6 flex items-center gap-3 text-xs uppercase tracking-widest">
                        <span class="w-2 h-2 bg-slate-900 rotate-45"></span>
                        Select Variant
                    </h3>
                    <div id="sidebar-list" class="space-y-1"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" onclick="closeEditModal()"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div class="relative transform overflow-hidden bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-md border border-slate-100">
                    <div class="bg-slate-900 px-6 py-4 flex justify-between items-center">
                        <h3 class="text-sm font-bold text-gold uppercase tracking-widest">Customize Data</h3>
                        <button type="button" class="text-slate-400 hover:text-white" onclick="closeEditModal()">✕</button>
                    </div>
                    <div class="px-8 py-8 space-y-6">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Project Name</label>
                            <input type="text" id="edit-thaiName" class="block w-full border-0 border-b border-slate-200 bg-transparent py-2 px-0 text-slate-900 focus:border-gold focus:ring-0 sm:text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Estimated Price</label>
                            <input type="text" id="edit-priceRange" class="block w-full border-0 border-b border-slate-200 bg-transparent py-2 px-0 text-slate-900 focus:border-gold focus:ring-0 sm:text-sm">
                        </div>
                        <div class="pt-2">
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Image URLs</label>
                            <input type="text" id="edit-plan-url" placeholder="Plan URL..." class="block w-full border-0 border-b border-slate-200 bg-transparent py-2 px-0 text-slate-900 focus:border-gold focus:ring-0 sm:text-sm mb-3">
                            <input type="text" id="edit-3d-url" placeholder="3D URL..." class="block w-full border-0 border-b border-slate-200 bg-transparent py-2 px-0 text-slate-900 focus:border-gold focus:ring-0 sm:text-sm">
                        </div>
                    </div>
                    <div class="bg-gray-50 px-6 py-4 flex flex-row-reverse">
                        <button onclick="saveEditData()" class="inline-flex w-full justify-center bg-slate-900 px-6 py-3 text-xs font-bold text-white uppercase tracking-wider hover:bg-black transition-all">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const seriesCatalog = [
            { id: "1822", w: 1.8, l: 2.2, label: "1.8 x 2.2 M" },
            { id: "1827", w: 1.8, l: 2.7, label: "1.8 x 2.7 M" },
            { id: "2222", w: 2.2, l: 2.2, label: "2.2 x 2.2 M" },
            { id: "2227", w: 2.2, l: 2.7, label: "2.2 x 2.7 M" },
            { id: "2231", w: 2.2, l: 3.1, label: "2.2 x 3.1 M" },
            { id: "2236", w: 2.2, l: 3.6, label: "2.2 x 3.6 M" },
            { id: "2245", w: 2.2, l: 4.5, label: "2.2 x 4.5 M" }
        ];

        const sanitaryDB = {
            "T": {
                standard: { toilet: "C13507 (2-Pc)", basin: "C014 (Wall Hung)", faucet: "CT1058A", desc: "Standard toilet set with wall hung basin" },
                premium: { toilet: "C10527 (1-Pc)", basin: "C0900 (Counter)", faucet: "CT1132A", desc: "Premium 1-piece toilet & counter basin" }
            },
            "S": {
                standard: { toilet: "C13507 (2-Pc)", basin: "C014 (Wall Hung)", faucet: "CT1058A", shower: "CT379A+Z71", desc: "Full standard set with shower" },
                premium: { toilet: "C10527 (1-Pc)", basin: "C0900 (Counter)", faucet: "CT1132A", shower: "CT542A+CT2047WS", desc: "Luxury set with Rain Shower" }
            },
            "U": {
                standard: { toilet: "C13507 (2-Pc)", basin: "C014 (Wall Hung)", urinal: "C31217", desc: "Standard set + Urinal" },
                premium: { toilet: "C10527 (1-Pc)", basin: "C0900 (Counter)", urinal: "C31217+Sensor", desc: "Premium set + Sensor Urinal" }
            }
        };

        const variants = [
            { id: "S", thaiName: "Standard", slogan: "Standard Layout (Wet+Dry)", basePrice: 8500, type: "Shower", badge: "Most Popular" },
            { id: "S1", thaiName: "Layout A", slogan: "Alternative Arrangement", basePrice: 8800, type: "Shower", badge: "Alt Layout" },
            { id: "S2", thaiName: "Layout B", slogan: "Wide Counter Support", basePrice: 9000, type: "Shower", badge: "Special" },
            { id: "T", thaiName: "Toilet", slogan: "Powder Room (No Shower)", basePrice: 6500, type: "Toilet", badge: "Dry Only" },
            { id: "U", thaiName: "Urinal", slogan: "Gentlemen's Toilet", basePrice: 7500, type: "Dry", badge: "Urinal" }
        ];

        // State
        let selectedSeriesId = "1822";
        let selectedVariantIndex = 0;
        let selectedGrade = "standard";
        let viewMode = 'detail';
        let activeTab = 'specs';
        let customData = {};

        // Icons (Gold/Black theme)
        const icons = {
            print: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0021 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 00-1.913-.247M6.34 18H5.25A2.25 2.25 0 013 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 011.913-.247m10.5 0a48.536 48.536 0 00-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5zm-3 0h.008v.008H15V10.5z" /></svg>`,
            download: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>`,
            edit: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg>`,
            camera: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" /><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" /></svg>`
        };

        function init() {
            document.getElementById('series-selector').innerHTML = seriesCatalog.map(s => `<option value="${s.id}">${s.label}</option>`).join('');
            render();
            updateSidebar();
        }

        function changeSeries() { selectedSeriesId = document.getElementById('series-selector').value; render(); updateSidebar(); }
        function changeGrade() { selectedGrade = document.getElementById('grade-selector').value; render(); updateSidebar(); }
        function setVariant(i) { selectedVariantIndex = i; render(); updateSidebar(); }
        function setTab(t) { activeTab = t; render(); }
        function switchView(m) { viewMode = m; render(); }

        function updateSidebar() {
            const series = seriesCatalog.find(s => s.id === selectedSeriesId);
            const variant = variants[selectedVariantIndex];
            const descEl = document.getElementById('sidebar-desc');
            
            document.getElementById('sidebar-model-code').innerText = `${series.id}${variant.id}`;
            document.getElementById('sidebar-model-size').innerText = `${series.w} x ${series.l} M`;
            document.getElementById('sidebar-function').innerText = variant.type;
            document.getElementById('sidebar-grade').innerText = selectedGrade === 'premium' ? "PREMIUM CLASS" : "STANDARD CLASS";
            
            if (descEl) {
                descEl.innerText = variant.thaiName;
            }
        }

        function getCalculatedData() {
            const series = seriesCatalog.find(s => s.id === selectedSeriesId);
            const variant = variants[selectedVariantIndex];
            const area = series.w * series.l;
            
            let pricePerSqm = variant.basePrice;
            if (selectedGrade === 'premium') pricePerSqm += 3500;
            if (series.id === '2245' && variant.id.includes('S')) pricePerSqm += 1000;

            let total = Math.round(area * pricePerSqm);
            const priceLow = Math.floor(total / 1000) * 1000;
            const priceHigh = priceLow + 5000;

            const key = `${selectedSeriesId}-${variant.id}`;
            const override = customData[key] || {};
            
            let typeKey = "S";
            if (variant.id.startsWith("T")) typeKey = "T";
            if (variant.id.startsWith("U")) typeKey = "U";
            const sanSpecs = sanitaryDB[typeKey][selectedGrade];

            return {
                ...variant, ...override,
                fullCode: `${series.id}${variant.id}`,
                seriesId: series.id, w: series.w, l: series.l, area: area.toFixed(2),
                priceRange: override.priceRange || `${(priceLow/1000).toFixed(0)}k - ${(priceHigh/1000).toFixed(0)}k`,
                avgPrice: (priceLow + priceHigh) / 2,
                sanSpecs: sanSpecs,
                customPlanUrl: override.customPlanUrl || null,
                custom3dUrl: override.custom3dUrl || null
            };
        }

        function exportBOQ() {
            const d = getCalculatedData();
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; 
            csvContent += "Category,Item,Specification,Note\n";
            csvContent += `Info,Model,${d.fullCode} (Size ${d.w}x${d.l}m),\n`;
            csvContent += `Info,Grade,${selectedGrade.toUpperCase()} Class,\n`;
            csvContent += `Cost,Estimate,${d.priceRange},Area ${d.area} sq.m.\n`;
            csvContent += `Sanitary,Toilet,${d.sanSpecs.toilet},\n`;
            csvContent += `Sanitary,Basin,${d.sanSpecs.basin},\n`;
            csvContent += `Sanitary,Faucet,${d.sanSpecs.faucet},\n`;
            if(d.sanSpecs.shower) csvContent += `Sanitary,Shower,${d.sanSpecs.shower},\n`;
            if(d.sanSpecs.urinal) csvContent += `Sanitary,Urinal,${d.sanSpecs.urinal},\n`;

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `BOQ_${d.fullCode}_${selectedGrade}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function render() {
            if (viewMode === 'dashboard') { renderDashboard(); document.getElementById('inner-tabs').classList.add('hidden'); return; }
            document.getElementById('inner-tabs').classList.remove('hidden');
            const d = getCalculatedData();

            // Nav (Top)
            document.getElementById('nav-container').innerHTML = variants.map((v, i) => {
                const active = selectedVariantIndex === i;
                return `
                <button onclick="setVariant(${i})" class="snap-start min-w-[140px] md:min-w-0 md:flex-1 p-4 transition-all duration-300 group border-b-2 ${active ? 'border-gold bg-white' : 'border-transparent hover:bg-white'}">
                    <div class="flex flex-col items-center gap-1">
                        <div class="text-[10px] font-bold uppercase tracking-wider ${active ? 'text-gold' : 'text-slate-400 group-hover:text-slate-600'}">Type ${v.id}</div>
                        <div class="text-sm font-medium ${active ? 'text-slate-900' : 'text-slate-400 group-hover:text-slate-600'}">${v.thaiName}</div>
                    </div>
                </button>`;
            }).join('');

            // Sidebar List (Right)
            document.getElementById('sidebar-list').innerHTML = variants.map((v, i) => {
                const active = selectedVariantIndex === i;
                return `
                <div onclick="setVariant(${i})" class="py-3 px-2 cursor-pointer transition-all flex items-center justify-between group border-b border-slate-50 hover:bg-gray-50">
                    <div class="flex items-center gap-4">
                        <div class="text-xs font-bold w-6 ${active ? 'text-gold' : 'text-slate-300 group-hover:text-slate-500'}">0${i+1}</div>
                        <div>
                            <div class="text-[10px] font-bold uppercase tracking-wider ${active ? 'text-slate-900' : 'text-slate-400'}">Type ${v.id}</div>
                            <div class="text-xs text-slate-500">${v.thaiName}</div>
                        </div>
                    </div>
                    ${active ? '<span class="text-gold text-xs">●</span>' : ''}
                </div>`;
            }).join('');

            const content = document.getElementById('content-area');
            
            // Tab Styling
            ['specs','plan','3d'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                if (t === activeTab) btn.className = "px-6 py-3 text-sm font-bold tracking-wide transition-all flex items-center gap-2 whitespace-nowrap border-b-2 border-gold text-slate-900 bg-white";
                else btn.className = "px-6 py-3 text-sm font-medium tracking-wide transition-all flex items-center gap-2 whitespace-nowrap border-b-2 border-transparent text-slate-400 hover:text-slate-600 hover:bg-slate-50";
            });

            if(activeTab === 'specs') {
                let sanHTML = `<li class="flex justify-between py-3 border-b border-slate-100"><span class="text-slate-400 text-xs uppercase tracking-wide">Toilet</span><span class="font-medium text-slate-800 text-sm text-right font-serif">${d.sanSpecs.toilet}</span></li>`;
                sanHTML += `<li class="flex justify-between py-3 border-b border-slate-100"><span class="text-slate-400 text-xs uppercase tracking-wide">Basin</span><span class="font-medium text-slate-800 text-sm text-right font-serif">${d.sanSpecs.basin}</span></li>`;
                sanHTML += `<li class="flex justify-between py-3 border-b border-slate-100"><span class="text-slate-400 text-xs uppercase tracking-wide">Faucet</span><span class="font-medium text-slate-800 text-sm text-right font-serif">${d.sanSpecs.faucet}</span></li>`;
                if(d.sanSpecs.shower) sanHTML += `<li class="flex justify-between py-3 border-b border-slate-100"><span class="text-slate-400 text-xs uppercase tracking-wide">Shower</span><span class="font-medium text-slate-800 text-sm text-right font-serif">${d.sanSpecs.shower}</span></li>`;
                if(d.sanSpecs.urinal) sanHTML += `<li class="flex justify-between py-3 border-b border-slate-100"><span class="text-slate-400 text-xs uppercase tracking-wide">Urinal</span><span class="font-medium text-slate-800 text-sm text-right font-serif">${d.sanSpecs.urinal}</span></li>`;

                content.innerHTML = `
                <div class="animate-fade-in p-8 h-full flex flex-col">
                    <div class="flex flex-col md:flex-row justify-between items-start gap-6 mb-10 pb-6 border-b border-slate-100">
                        <div>
                            <span class="text-[10px] font-bold text-gold uppercase tracking-[0.15em] mb-1 block">Project Estimation</span>
                            <h2 class="text-4xl font-serif text-slate-900">${d.thaiName}</h2>
                            <p class="text-slate-400 text-sm mt-2 font-light">Model: ${d.fullCode} <span class="mx-2 text-slate-200">|</span> Area: ${d.area} sq.m.</p>
                        </div>
                        <div class="flex gap-3 no-print">
                            <button onclick="window.print()" class="bg-white hover:bg-slate-50 text-slate-900 border border-slate-200 px-4 py-2 rounded-none text-xs font-bold uppercase tracking-wider transition-all flex items-center gap-2">${icons.print} Print</button>
                            <button onclick="openEditModal()" class="bg-slate-900 hover:bg-black text-white px-4 py-2 rounded-none text-xs font-bold uppercase tracking-wider transition-all flex items-center gap-2 shadow-lg">${icons.edit} Edit</button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
                        <!-- Specs -->
                        <div class="lg:col-span-7 space-y-8">
                            <div>
                                <h3 class="font-bold text-slate-900 mb-6 text-xs uppercase tracking-widest border-b border-slate-900 pb-2 inline-block">Technical Specifications</h3>
                                <ul class="space-y-1">${sanHTML}</ul>
                            </div>
                            <div class="bg-gray-50 p-6 border-l-2 border-gold">
                                <h4 class="font-bold text-slate-900 mb-2 text-xs uppercase tracking-wide">Design Note</h4>
                                <p class="text-sm text-slate-500 font-light leading-relaxed">"${d.slogan}" - Designed for optimal space utilization with ${selectedGrade} grade sanitary ware.</p>
                            </div>
                        </div>
                        
                        <!-- Price Block -->
                        <div class="lg:col-span-5">
                            <div class="bg-slate-900 text-white p-8 relative overflow-hidden shadow-2xl">
                                <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500 rounded-full blur-[60px] opacity-20"></div>
                                <span class="block text-slate-400 text-[10px] font-bold uppercase tracking-widest mb-2">Total Estimation</span>
                                <span class="text-4xl font-serif text-white block mb-6">${d.priceRange}</span>
                                
                                <div class="space-y-3 border-t border-slate-800 pt-6">
                                    <div class="flex justify-between text-xs">
                                        <span class="text-slate-500">Material Cost</span>
                                        <span class="text-slate-300">60%</span>
                                    </div>
                                    <div class="w-full bg-slate-800 h-1">
                                        <div class="bg-gold h-1 w-[60%]"></div>
                                    </div>
                                    <div class="flex justify-between text-xs">
                                        <span class="text-slate-500">Labor Cost</span>
                                        <span class="text-slate-300">40%</span>
                                    </div>
                                </div>
                                <button onclick="exportBOQ()" class="mt-8 w-full bg-gold text-slate-900 py-3 text-xs font-bold uppercase tracking-wider hover:bg-white transition-colors">Download BOQ</button>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            } else if (activeTab === 'plan') {
                const img = d.customPlanUrl ? `<img src="${d.customPlanUrl}" class="max-h-full shadow-2xl">` : `<div class="bg-white p-10 shadow-2xl border border-slate-100 relative"><div class="absolute top-4 left-4 text-[10px] font-bold text-slate-300 uppercase tracking-widest">Floor Plan View</div><div class="bg-blueprint p-10 border border-slate-200"><svg width="${d.w*120}" height="${d.l*120}" xmlns="http://www.w3.org/2000/svg" style="background:white"><rect x="0" y="0" width="${d.w*120}" height="${d.l*120}" fill="none" stroke="#1e293b" stroke-width="4"/><text x="${d.w*60}" y="${d.l*60}" text-anchor="middle" fill="#94a3b8" font-family="serif" font-size="24" font-style="italic">Model ${d.fullCode}</text></svg></div></div>`;
                content.innerHTML = `<div class="h-full flex flex-col items-center justify-center p-8 relative bg-gray-50"><div class="absolute top-6 right-6 z-20 no-print"><button onclick="openEditModal()" class="bg-white text-slate-900 px-4 py-2 text-xs font-bold uppercase tracking-wider shadow-lg hover:bg-gold transition-all border border-slate-200">Upload Plan</button></div>${img}</div>`;
            } else {
                const img = d.custom3dUrl ? `<img src="${d.custom3dUrl}" class="shadow-2xl w-full">` : `<div class="relative shadow-2xl w-full aspect-video bg-slate-900 flex items-center justify-center"><div class="text-center"><span class="text-gold text-4xl font-serif block mb-2">${d.fullCode}</span><span class="text-slate-500 text-xs uppercase tracking-widest">3D Rendering Not Available</span></div></div>`;
                content.innerHTML = `<div class="h-full flex flex-col items-center justify-center p-8 relative bg-gray-50"><div class="absolute top-6 right-6 z-20 no-print"><button onclick="openEditModal()" class="bg-white text-slate-900 px-4 py-2 text-xs font-bold uppercase tracking-wider shadow-lg hover:bg-gold transition-all border border-slate-200">Upload 3D</button></div><div class="w-full max-w-5xl">${img}</div></div>`;
            }
        }

        function renderDashboard() {
            const content = document.getElementById('content-area');
            const series = seriesCatalog.find(s => s.id === selectedSeriesId);
            const data = variants.map(v => {
                let p = Math.round(series.w * series.l * (v.basePrice + (selectedGrade==='premium'?3500:0)));
                return { name: v.id, price: p, label: v.thaiName };
            });
            const max = Math.max(...data.map(d=>d.price)) * 1.2;
            const bars = data.map(d => `
                <div class="flex flex-col items-center gap-4 w-full group">
                    <div class="relative w-full h-64 flex items-end justify-center px-4 pb-0 border-b border-slate-200">
                        <div class="w-full bg-slate-900 relative transition-all duration-1000 ease-out group-hover:bg-gold" style="height:${(d.price/max)*100}%">
                            <span class="absolute -top-10 left-1/2 -translate-x-1/2 text-sm font-serif text-slate-900 opacity-0 group-hover:opacity-100 transition-opacity bg-white border border-slate-200 px-3 py-1 shadow-xl">${(d.price/1000).toFixed(1)}k</span>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-1">${d.name}</div>
                        <div class="text-[10px] text-slate-400 uppercase">${d.label}</div>
                    </div>
                </div>`).join('');
            
            content.innerHTML = `
            <div class="animate-fade-in p-12 h-full bg-white">
                <div class="flex justify-between items-end mb-16 border-b border-slate-100 pb-6">
                    <div>
                        <span class="text-gold text-[10px] font-bold uppercase tracking-[0.2em] block mb-2">Financial Overview</span>
                        <h2 class="text-3xl font-serif text-slate-900">Cost Comparison</h2>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-bold uppercase tracking-widest text-slate-400 bg-slate-50 px-4 py-2">${selectedGrade} Grade</span>
                    </div>
                </div>
                <div class="grid grid-cols-5 gap-8 items-end h-80 mb-8">${bars}</div>
            </div>`;
        }

        // Modal Functions
        function openEditModal() {
            const d = getCalculatedData();
            document.getElementById('edit-thaiName').value = d.thaiName;
            document.getElementById('edit-priceRange').value = d.priceRange;
            document.getElementById('edit-plan-url').value = d.customPlanUrl || '';
            document.getElementById('edit-3d-url').value = d.custom3dUrl || '';
            document.getElementById('edit-modal').classList.remove('hidden');
        }
        function closeEditModal() { document.getElementById('edit-modal').classList.add('hidden'); }
        function saveEditData() {
            const key = `${selectedSeriesId}-${variants[selectedVariantIndex].id}`;
            customData[key] = {
                thaiName: document.getElementById('edit-thaiName').value,
                priceRange: document.getElementById('edit-priceRange').value,
                customPlanUrl: document.getElementById('edit-plan-url').value,
                custom3dUrl: document.getElementById('edit-3d-url').value
            };
            closeEditModal(); render();
        }

        init();
    </script>
</body>
</html>
