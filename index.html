<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Bathroom Estimator (Clean Style)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'IBM Plex Sans Thai', sans-serif; 
            background-color: #f0f4f8; /* Soft Cloud Blue Background */
            color: #334155;
        }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        /* Clean Blueprint Pattern */
        .bg-blueprint {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(#e2e8f0 1px, transparent 1px), 
                linear-gradient(90deg, #e2e8f0 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Glass Effect */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* Soft Shadow */
        .shadow-soft {
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.05);
        }

        @media print {
            body { background-color: white; padding: 0; }
            #sidebar-col, #nav-wrapper, header .flex-col, .no-print, #inner-tabs { display: none !important; }
            #main-content-col { width: 100%; grid-column: span 12; }
            #content-area { border: none; box-shadow: none; min-height: auto; background: white !important; }
            .print-full-width { width: 100% !important; }
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8 flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
            <div class="text-left">
                <div class="text-xs font-bold text-cyan-600 uppercase tracking-widest mb-2 flex items-center gap-2">
                    <span class="w-8 h-[1px] bg-cyan-600 inline-block"></span> 
                    ESTIMATOR & BOQ SYSTEM
                </div>
                <h1 class="text-3xl md:text-4xl font-light text-slate-800">
                    Bathroom <span class="font-semibold">Model Selector</span>
                </h1>
                <p class="text-slate-400 text-sm mt-1 font-light">ระบบประเมินราคาและถอดแบบรหัสสุขภัณฑ์ (2016 Series)</p>
            </div>
            
            <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto items-end no-print">
                <div class="relative w-full md:w-48 group">
                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 group-hover:text-cyan-600 transition-colors">Sanitary Grade</label>
                    <div class="relative">
                        <select id="grade-selector" onchange="changeGrade()" class="block w-full appearance-none rounded-xl border-0 bg-white py-3 pl-4 pr-10 text-slate-700 shadow-sm ring-1 ring-inset ring-slate-200 focus:ring-2 focus:ring-cyan-500 sm:text-sm font-medium cursor-pointer transition-all hover:ring-cyan-200">
                            <option value="standard">Standard Class</option>
                            <option value="premium">Premium Class</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-slate-400">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" /></svg>
                        </div>
                    </div>
                </div>
                <div class="relative w-full md:w-48 group">
                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 group-hover:text-cyan-600 transition-colors">Room Size</label>
                    <div class="relative">
                        <select id="series-selector" onchange="changeSeries()" class="block w-full appearance-none rounded-xl border-0 bg-white py-3 pl-4 pr-10 text-slate-700 shadow-sm ring-1 ring-inset ring-slate-200 focus:ring-2 focus:ring-cyan-500 sm:text-sm font-medium cursor-pointer transition-all hover:ring-cyan-200"></select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-slate-400">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" /></svg>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-1 rounded-xl shadow-sm ring-1 ring-slate-200 flex relative">
                    <button onclick="switchView('detail')" id="btn-detail" class="px-5 py-2.5 rounded-lg text-sm font-medium transition-all text-cyan-700 bg-cyan-50">Detail</button>
                    <button onclick="switchView('dashboard')" id="btn-dashboard" class="px-5 py-2.5 rounded-lg text-sm font-medium transition-all text-slate-400 hover:text-slate-600">Analytics</button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <div id="nav-wrapper" class="sticky top-0 z-30 bg-[#f0f4f8]/80 backdrop-blur-md py-4 mb-6 -mx-4 px-4 md:static md:bg-transparent md:p-0 md:m-0 transition-all duration-300 no-print">
            <div id="nav-container" class="flex md:grid md:grid-cols-5 gap-4 overflow-x-auto hide-scrollbar pb-2 md:pb-0 snap-x"></div>
        </div>

        <!-- Main Content -->
        <div class="grid lg:grid-cols-12 gap-8 items-start">
            <div id="main-content-col" class="lg:col-span-8 xl:col-span-9 transition-all">
                <!-- Tabs -->
                <div id="inner-tabs" class="flex gap-2 mb-6 overflow-x-auto pb-1 hide-scrollbar no-print">
                    <button onclick="setTab('specs')" id="tab-specs" class="px-5 py-2 rounded-full text-sm font-medium bg-cyan-600 text-white shadow-lg shadow-cyan-200 transition-all flex items-center gap-2 whitespace-nowrap">
                        Specs & BOQ
                    </button>
                    <button onclick="setTab('plan')" id="tab-plan" class="px-5 py-2 rounded-full text-sm font-medium bg-white text-slate-500 hover:bg-white hover:text-cyan-600 hover:shadow-md transition-all flex items-center gap-2 whitespace-nowrap border border-transparent hover:border-cyan-100">
                        Floor Plan
                    </button>
                    <button onclick="setTab('3d')" id="tab-3d" class="px-5 py-2 rounded-full text-sm font-medium bg-white text-slate-500 hover:bg-white hover:text-cyan-600 hover:shadow-md transition-all flex items-center gap-2 whitespace-nowrap border border-transparent hover:border-cyan-100">
                        3D View
                    </button>
                </div>

                <div id="content-area" class="min-h-[600px] rounded-[2rem] transition-all duration-500 relative overflow-hidden bg-white shadow-soft ring-1 ring-slate-100"></div>
            </div>

            <!-- Sidebar -->
            <div id="sidebar-col" class="lg:col-span-4 xl:col-span-3 space-y-6 sticky top-24 transition-all no-print">
                <!-- Info Card -->
                <div class="bg-white rounded-3xl shadow-soft p-6 relative overflow-hidden group ring-1 ring-slate-100">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-cyan-50 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                    <h3 class="font-bold text-slate-400 mb-2 text-[10px] uppercase tracking-widest">Selected Configuration</h3>
                    <div class="text-4xl font-light text-slate-800 mb-1 flex items-baseline gap-2 tracking-tight">
                        <span id="sidebar-model-code">...</span>
                    </div>
                    <div class="flex flex-wrap gap-2 mb-6">
                        <span class="text-xs font-semibold px-2 py-1 rounded bg-slate-100 text-slate-500" id="sidebar-grade">STD</span>
                        <span class="text-xs font-semibold px-2 py-1 rounded bg-slate-100 text-slate-500" id="sidebar-function">...</span>
                    </div>
                    
                    <div class="space-y-3 pt-4 border-t border-slate-50">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-slate-400">Dimensions</span>
                            <span class="font-medium text-slate-700" id="sidebar-model-size">...</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-slate-400">Layout</span>
                            <span class="font-medium text-slate-700" id="sidebar-desc">...</span>
                        </div>
                    </div>
                </div>
                
                <!-- List -->
                <div class="glass-panel rounded-3xl p-6">
                    <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2 pb-3 border-b border-slate-100 text-sm">
                        <span class="w-1.5 h-1.5 rounded-full bg-cyan-500"></span>
                        Available Variants
                    </h3>
                    <div id="sidebar-list" class="space-y-2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/20 backdrop-blur-sm transition-opacity" onclick="closeEditModal()"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-3xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-md ring-1 ring-slate-100">
                    <div class="bg-white px-4 py-5 sm:px-6 flex justify-between items-center border-b border-slate-50">
                        <h3 class="text-lg font-medium leading-6 text-slate-800">Customize Data</h3>
                        <button type="button" class="text-slate-400 hover:text-slate-600 bg-slate-50 rounded-full p-1" onclick="closeEditModal()">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                        </button>
                    </div>
                    <div class="px-6 py-6 space-y-5">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1.5">Project Name / Type</label>
                            <input type="text" id="edit-thaiName" class="block w-full rounded-xl border-slate-200 bg-slate-50 focus:border-cyan-500 focus:bg-white focus:ring-cyan-500 sm:text-sm transition-all">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1.5">Estimated Price</label>
                            <input type="text" id="edit-priceRange" class="block w-full rounded-xl border-slate-200 bg-slate-50 focus:border-cyan-500 focus:bg-white focus:ring-cyan-500 sm:text-sm transition-all">
                        </div>
                        <div class="pt-4 border-t border-slate-50">
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-3">External Image URLs</label>
                            <input type="text" id="edit-plan-url" placeholder="Plan URL (https://...)" class="block w-full rounded-xl border-slate-200 bg-slate-50 focus:border-cyan-500 focus:bg-white focus:ring-cyan-500 sm:text-sm mb-3 transition-all">
                            <input type="text" id="edit-3d-url" placeholder="3D Render URL (https://...)" class="block w-full rounded-xl border-slate-200 bg-slate-50 focus:border-cyan-500 focus:bg-white focus:ring-cyan-500 sm:text-sm transition-all">
                        </div>
                    </div>
                    <div class="bg-slate-50 px-6 py-4 flex flex-row-reverse">
                        <button onclick="saveEditData()" class="inline-flex w-full justify-center rounded-xl bg-cyan-600 px-4 py-3 text-sm font-semibold text-white shadow-lg shadow-cyan-200 hover:bg-cyan-700 sm:ml-3 sm:w-auto transition-all">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const seriesCatalog = [
            { id: "1822", w: 1.8, l: 2.2, label: "Size 1.8 x 2.2 m" },
            { id: "1827", w: 1.8, l: 2.7, label: "Size 1.8 x 2.7 m" },
            { id: "2222", w: 2.2, l: 2.2, label: "Size 2.2 x 2.2 m" },
            { id: "2227", w: 2.2, l: 2.7, label: "Size 2.2 x 2.7 m" },
            { id: "2231", w: 2.2, l: 3.1, label: "Size 2.2 x 3.1 m" },
            { id: "2236", w: 2.2, l: 3.6, label: "Size 2.2 x 3.6 m" },
            { id: "2245", w: 2.2, l: 4.5, label: "Size 2.2 x 4.5 m" }
        ];

        const sanitaryDB = {
            "T": {
                standard: { toilet: "C13507 (2-Pc)", basin: "C014 (Wall Hung)", faucet: "CT1058A", desc: "Standard toilet set with wall hung basin" },
                premium: { toilet: "C10527 (1-Pc)", basin: "C0900 (Counter)", faucet: "CT1132A", desc: "Premium 1-piece toilet & counter basin" }
            },
            "S": {
                standard: { toilet: "C13507 (2-Pc)", basin: "C014 (Wall Hung)", faucet: "CT1058A", shower: "CT379A+Z71", desc: "Full standard set with shower" },
                premium: { toilet: "C10527 (1-Pc)", basin: "C0900 (Counter)", faucet: "CT1132A", shower: "CT542A+CT2047WS", desc: "Luxury set with Rain Shower" }
            },
            "U": {
                standard: { toilet: "C13507 (2-Pc)", basin: "C014 (Wall Hung)", urinal: "C31217", desc: "Standard set + Urinal" },
                premium: { toilet: "C10527 (1-Pc)", basin: "C0900 (Counter)", urinal: "C31217+Sensor", desc: "Premium set + Sensor Urinal" }
            }
        };

        const variants = [
            { id: "S", thaiName: "Standard", slogan: "Standard Layout (Wet+Dry)", basePrice: 8500, type: "Shower", badge: "Most Popular" },
            { id: "S1", thaiName: "Layout A", slogan: "Alternative Arrangement", basePrice: 8800, type: "Shower", badge: "Alt Layout" },
            { id: "S2", thaiName: "Layout B", slogan: "Wide Counter Support", basePrice: 9000, type: "Shower", badge: "Special" },
            { id: "T", thaiName: "Toilet", slogan: "Powder Room (No Shower)", basePrice: 6500, type: "Toilet", badge: "Dry Only" },
            { id: "U", thaiName: "Urinal", slogan: "Gentlemen's Toilet", basePrice: 7500, type: "Dry", badge: "Urinal" }
        ];

        // State
        let selectedSeriesId = "1822";
        let selectedVariantIndex = 0;
        let selectedGrade = "standard";
        let viewMode = 'detail';
        let activeTab = 'specs';
        let customData = {};

        // Icons (Clean Stroke)
        const icons = {
            print: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0021 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 00-1.913-.247M6.34 18H5.25A2.25 2.25 0 013 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 011.913-.247m10.5 0a48.536 48.536 0 00-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5zm-3 0h.008v.008H15V10.5z" /></svg>`,
            download: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>`,
            edit: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg>`,
            camera: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" /><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" /></svg>`
        };

        function init() {
            document.getElementById('series-selector').innerHTML = seriesCatalog.map(s => `<option value="${s.id}">${s.label}</option>`).join('');
            render();
            updateSidebar();
        }

        function changeSeries() { selectedSeriesId = document.getElementById('series-selector').value; render(); updateSidebar(); }
        function changeGrade() { selectedGrade = document.getElementById('grade-selector').value; render(); updateSidebar(); }
        function setVariant(i) { selectedVariantIndex = i; render(); updateSidebar(); }
        function setTab(t) { activeTab = t; render(); }
        function switchView(m) { viewMode = m; render(); }

        function updateSidebar() {
            const series = seriesCatalog.find(s => s.id === selectedSeriesId);
            const variant = variants[selectedVariantIndex];
            document.getElementById('sidebar-model-code').innerText = `${series.id}${variant.id}`;
            document.getElementById('sidebar-model-size').innerText = `${series.w} x ${series.l} m`;
            document.getElementById('sidebar-function').innerText = variant.type;
            document.getElementById('sidebar-desc').innerText = variant.thaiName;
            document.getElementById('sidebar-grade').innerText = selectedGrade === 'premium' ? "PREMIUM" : "STD";
            document.getElementById('sidebar-grade').className = `text-[10px] font-bold px-2 py-1 rounded tracking-wider ${selectedGrade === 'premium' ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-500'}`;
        }

        function getCalculatedData() {
            const series = seriesCatalog.find(s => s.id === selectedSeriesId);
            const variant = variants[selectedVariantIndex];
            const area = series.w * series.l;
            
            let pricePerSqm = variant.basePrice;
            if (selectedGrade === 'premium') pricePerSqm += 3500;
            if (series.id === '2245' && variant.id.includes('S')) pricePerSqm += 1000;

            let total = Math.round(area * pricePerSqm);
            const priceLow = Math.floor(total / 1000) * 1000;
            const priceHigh = priceLow + 5000;

            const key = `${selectedSeriesId}-${variant.id}`;
            const override = customData[key] || {};
            
            let typeKey = "S";
            if (variant.id.startsWith("T")) typeKey = "T";
            if (variant.id.startsWith("U")) typeKey = "U";
            const sanSpecs = sanitaryDB[typeKey][selectedGrade];

            return {
                ...variant, ...override,
                fullCode: `${series.id}${variant.id}`,
                seriesId: series.id, w: series.w, l: series.l, area: area.toFixed(2),
                priceRange: override.priceRange || `${(priceLow/1000).toFixed(0)}k - ${(priceHigh/1000).toFixed(0)}k`,
                avgPrice: (priceLow + priceHigh) / 2,
                sanSpecs: sanSpecs,
                customPlanUrl: override.customPlanUrl || null,
                custom3dUrl: override.custom3dUrl || null
            };
        }

        function exportBOQ() {
            const d = getCalculatedData();
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; 
            csvContent += "Category,Item,Specification,Note\n";
            csvContent += `Info,Model,${d.fullCode} (Size ${d.w}x${d.l}m),\n`;
            csvContent += `Info,Grade,${selectedGrade.toUpperCase()} Class,\n`;
            csvContent += `Cost,Estimate,${d.priceRange},Area ${d.area} sq.m.\n`;
            csvContent += `Sanitary,Toilet,${d.sanSpecs.toilet},\n`;
            csvContent += `Sanitary,Basin,${d.sanSpecs.basin},\n`;
            csvContent += `Sanitary,Faucet,${d.sanSpecs.faucet},\n`;
            if(d.sanSpecs.shower) csvContent += `Sanitary,Shower,${d.sanSpecs.shower},\n`;
            if(d.sanSpecs.urinal) csvContent += `Sanitary,Urinal,${d.sanSpecs.urinal},\n`;

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `BOQ_${d.fullCode}_${selectedGrade}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function render() {
            if (viewMode === 'dashboard') { renderDashboard(); document.getElementById('inner-tabs').classList.add('hidden'); return; }
            document.getElementById('inner-tabs').classList.remove('hidden');
            const d = getCalculatedData();

            // Nav
            document.getElementById('nav-container').innerHTML = variants.map((v, i) => {
                const active = selectedVariantIndex === i;
                return `
                <button onclick="setVariant(${i})" class="snap-start min-w-[140px] md:min-w-0 md:flex-1 p-4 rounded-2xl border transition-all duration-300 group ${active ? 'bg-white border-transparent shadow-soft ring-1 ring-cyan-100 -translate-y-1' : 'bg-transparent border-transparent hover:bg-white/50'}">
                    <div class="flex flex-col items-center gap-2">
                        <div class="text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded-full ${active ? 'bg-cyan-50 text-cyan-600' : 'bg-slate-100 text-slate-400 group-hover:bg-white'}">Type ${v.id}</div>
                        <div class="text-sm font-medium ${active ? 'text-slate-800' : 'text-slate-400'}">${v.thaiName}</div>
                    </div>
                </button>`;
            }).join('');

            // Sidebar List
            document.getElementById('sidebar-list').innerHTML = variants.map((v, i) => {
                const active = selectedVariantIndex === i;
                return `
                <div onclick="setVariant(${i})" class="p-3 rounded-xl cursor-pointer transition-all flex items-center justify-between group ${active ? 'bg-cyan-50' : 'hover:bg-slate-50'}">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold transition-colors ${active ? 'bg-cyan-500 text-white' : 'bg-slate-100 text-slate-400 group-hover:bg-white'}">${v.id}</div>
                        <div class="font-medium text-sm ${active ? 'text-cyan-900' : 'text-slate-600'}">${v.thaiName}</div>
                    </div>
                    ${active ? '<div class="w-1.5 h-1.5 rounded-full bg-cyan-500"></div>' : ''}
                </div>`;
            }).join('');

            const content = document.getElementById('content-area');
            
            // Tab Logic
            ['specs','plan','3d'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                if (t === activeTab) btn.className = "px-5 py-2 rounded-full text-sm font-medium bg-cyan-600 text-white shadow-lg shadow-cyan-200 transition-all flex items-center gap-2 whitespace-nowrap scale-105";
                else btn.className = "px-5 py-2 rounded-full text-sm font-medium bg-white text-slate-500 hover:bg-white hover:text-cyan-600 hover:shadow-md transition-all flex items-center gap-2 whitespace-nowrap border border-transparent hover:border-cyan-100";
            });

            if(activeTab === 'specs') {
                let sanHTML = `<li class="flex justify-between py-3 border-b border-slate-50"><span class="text-slate-500 text-sm">Toilet</span><span class="font-medium text-slate-800 text-sm text-right">${d.sanSpecs.toilet}</span></li>`;
                sanHTML += `<li class="flex justify-between py-3 border-b border-slate-50"><span class="text-slate-500 text-sm">Basin</span><span class="font-medium text-slate-800 text-sm text-right">${d.sanSpecs.basin}</span></li>`;
                sanHTML += `<li class="flex justify-between py-3 border-b border-slate-50"><span class="text-slate-500 text-sm">Faucet</span><span class="font-medium text-slate-800 text-sm text-right">${d.sanSpecs.faucet}</span></li>`;
                if(d.sanSpecs.shower) sanHTML += `<li class="flex justify-between py-3 border-b border-slate-50"><span class="text-slate-500 text-sm">Shower</span><span class="font-medium text-slate-800 text-sm text-right">${d.sanSpecs.shower}</span></li>`;
                if(d.sanSpecs.urinal) sanHTML += `<li class="flex justify-between py-3 border-b border-slate-50"><span class="text-slate-500 text-sm">Urinal</span><span class="font-medium text-slate-800 text-sm text-right">${d.sanSpecs.urinal}</span></li>`;

                content.innerHTML = `
                <div class="animate-fade-in p-8 h-full flex flex-col">
                    <!-- Top Info -->
                    <div class="flex flex-col md:flex-row justify-between items-start gap-6 mb-8 border-b border-slate-50 pb-6">
                        <div>
                            <div class="flex items-center gap-3 mb-2">
                                <span class="bg-cyan-100 text-cyan-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">${d.fullCode}</span>
                                <span class="text-xs font-bold text-slate-400 bg-slate-50 px-2 py-1 rounded-full border border-slate-100 uppercase">${selectedGrade}</span>
                            </div>
                            <h2 class="text-3xl font-light text-slate-800 mb-1">${d.thaiName}</h2>
                            <p class="text-slate-400 text-sm font-light">"${d.slogan}"</p>
                        </div>
                        <div class="flex gap-2 no-print">
                            <button onclick="window.print()" class="bg-white hover:bg-slate-50 text-slate-500 hover:text-slate-700 p-3 rounded-xl border border-slate-200 transition-all flex items-center gap-2 font-bold text-xs shadow-sm">${icons.print} Print</button>
                            <button onclick="exportBOQ()" class="bg-cyan-600 hover:bg-cyan-700 text-white p-3 rounded-xl shadow-lg shadow-cyan-100 flex items-center gap-2 font-bold text-xs transition-all">${icons.download} BOQ</button>
                            <button onclick="openEditModal()" class="bg-white hover:bg-slate-50 p-3 rounded-xl border border-slate-200 text-slate-400 hover:text-cyan-600 transition-all shadow-sm">${icons.edit}</button>
                        </div>
                    </div>
                    
                    <!-- Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                        <div class="space-y-6">
                            <div class="bg-slate-50 rounded-2xl p-6 border border-slate-100">
                                <h3 class="font-bold text-slate-800 mb-4 text-sm uppercase tracking-wide">Specification Details</h3>
                                <ul class="space-y-1">${sanHTML}</ul>
                                <div class="mt-4 text-[10px] text-slate-400 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-emerald-400"></span> In Stock (2016 Catalog)
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-6">
                            <!-- Price Card -->
                            <div class="bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-2xl p-6 text-white shadow-lg shadow-cyan-200 relative overflow-hidden">
                                <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full blur-2xl"></div>
                                <span class="block text-cyan-100 text-xs font-medium uppercase tracking-wider mb-1">Estimated Cost</span>
                                <span class="text-3xl font-bold">${d.priceRange}</span>
                                <div class="mt-4 flex items-center justify-between border-t border-white/20 pt-4">
                                    <span class="text-xs text-cyan-100">Area Size</span>
                                    <span class="text-sm font-semibold">${d.area} sq.m.</span>
                                </div>
                            </div>
                            
                            <!-- Highlights -->
                            <div class="bg-white rounded-2xl p-6 border border-slate-100">
                                <h4 class="font-bold text-slate-700 mb-3 text-xs uppercase tracking-wide">Highlights</h4>
                                <div class="text-sm text-slate-600 leading-relaxed bg-slate-50 p-4 rounded-xl">
                                    ${d.badge} model suited for ${d.w}x${d.l}m spaces. Includes standard finishing and sanitary wares from ${selectedGrade} collection.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            } else if (activeTab === 'plan') {
                const img = d.customPlanUrl ? `<img src="${d.customPlanUrl}" class="max-h-full rounded-lg shadow-lg">` : `<div class="bg-white p-8 rounded-2xl shadow-soft border border-slate-100"><h3 class="text-center font-bold text-slate-300 mb-4 text-xs uppercase tracking-widest">Auto-Generated Plan</h3><div class="bg-blueprint p-8 rounded-xl border border-slate-200"><svg width="${d.w*100}" height="${d.l*100}" xmlns="http://www.w3.org/2000/svg" style="background:white"><rect x="0" y="0" width="${d.w*100}" height="${d.l*100}" fill="white" stroke="#334155" stroke-width="4"/><text x="${d.w*50}" y="${d.l*50}" text-anchor="middle" fill="#cbd5e1" font-size="20" font-family="sans-serif" font-weight="bold">${d.fullCode}</text></svg></div></div>`;
                content.innerHTML = `<div class="h-full flex flex-col items-center justify-center p-8 relative bg-slate-50"><div class="absolute top-6 right-6 z-20 no-print"><button onclick="openEditModal()" class="bg-white hover:bg-slate-50 text-slate-600 px-4 py-2 rounded-xl shadow-sm border border-slate-200 text-xs font-bold flex items-center gap-2 transition-all">${icons.edit} Change Plan</button></div>${img}</div>`;
            } else {
                const img = d.custom3dUrl ? `<img src="${d.custom3dUrl}" class="rounded-2xl shadow-soft w-full">` : `<div class="relative rounded-2xl overflow-hidden shadow-soft w-full aspect-video bg-slate-200"><img src="https://placehold.co/1200x800/f1f5f9/94a3b8?text=3D+Render+${d.fullCode}" class="w-full h-full object-cover opacity-80 mix-blend-multiply"><div class="absolute inset-0 flex items-center justify-center text-slate-400 font-light text-lg">No 3D Image Uploaded</div></div>`;
                content.innerHTML = `<div class="h-full flex flex-col items-center justify-center p-8 relative bg-slate-50"><div class="absolute top-6 right-6 z-20 no-print"><button onclick="openEditModal()" class="bg-white hover:bg-slate-50 text-slate-600 px-4 py-2 rounded-xl shadow-sm border border-slate-200 text-xs font-bold flex items-center gap-2 transition-all">${icons.camera} Add 3D Image</button></div><div class="w-full max-w-4xl">${img}</div></div>`;
            }
        }

        function renderDashboard() {
            const content = document.getElementById('content-area');
            const series = seriesCatalog.find(s => s.id === selectedSeriesId);
            const data = variants.map(v => {
                let p = Math.round(series.w * series.l * (v.basePrice + (selectedGrade==='premium'?3500:0)));
                return { name: v.id, price: p, label: v.thaiName };
            });
            const max = Math.max(...data.map(d=>d.price)) * 1.2;
            const bars = data.map(d => `
                <div class="flex flex-col items-center gap-3 w-full group">
                    <div class="relative w-full h-64 bg-slate-50 rounded-2xl flex items-end justify-center px-6 pb-4 border border-slate-100 group-hover:border-cyan-100 transition-colors">
                        <div class="w-full bg-cyan-500 rounded-t-lg relative transition-all duration-1000 ease-out group-hover:bg-cyan-400 shadow-lg shadow-cyan-100" style="height:${(d.price/max)*100}%">
                            <span class="absolute -top-8 left-1/2 -translate-x-1/2 text-sm font-bold text-slate-600 opacity-0 group-hover:opacity-100 transition-opacity bg-white px-2 py-1 rounded shadow-sm">${(d.price/1000).toFixed(1)}k</span>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm font-bold text-slate-700">${d.name}</div>
                        <div class="text-[10px] text-slate-400">${d.label}</div>
                    </div>
                </div>`).join('');
            
            content.innerHTML = `
            <div class="animate-fade-in p-8 h-full">
                <div class="flex justify-between items-end mb-10">
                    <div>
                        <h2 class="text-2xl font-light text-slate-800 mb-2">Cost Analytics</h2>
                        <p class="text-slate-400 text-sm">Comparing estimated costs for Series ${selectedSeriesId}</p>
                    </div>
                    <div class="text-right">
                        <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400 bg-slate-100 px-3 py-1 rounded-full">${selectedGrade} Grade</span>
                    </div>
                </div>
                <div class="grid grid-cols-5 gap-6 items-end h-80 mb-8">${bars}</div>
            </div>`;
        }

        // Modal Functions
        function openEditModal() {
            const d = getCalculatedData();
            document.getElementById('edit-thaiName').value = d.thaiName;
            document.getElementById('edit-priceRange').value = d.priceRange;
            document.getElementById('edit-plan-url').value = d.customPlanUrl || '';
            document.getElementById('edit-3d-url').value = d.custom3dUrl || '';
            document.getElementById('edit-modal').classList.remove('hidden');
        }
        function closeEditModal() { document.getElementById('edit-modal').classList.add('hidden'); }
        function saveEditData() {
            const key = `${selectedSeriesId}-${variants[selectedVariantIndex].id}`;
            customData[key] = {
                thaiName: document.getElementById('edit-thaiName').value,
                priceRange: document.getElementById('edit-priceRange').value,
                customPlanUrl: document.getElementById('edit-plan-url').value,
                custom3dUrl: document.getElementById('edit-3d-url').value
            };
            closeEditModal(); render();
        }

        init();
    </script>
</body>
</html>
